<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns="http://www.w3.org/1999/html"
      layout:decorate="~{layouts/admin-layout}">

<head>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}">
</head>
<th:block layout:fragment="css">
    <style>
        body {
            background: #f8f9fa;
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 20%, rgba(106, 13, 173, 0.05) 0%, transparent 40%),
                radial-gradient(circle at 80% 80%, rgba(106, 13, 173, 0.05) 0%, transparent 40%);
            pointer-events: none;
        }

        .container {
            max-width: 900px;
            padding: 40px;
            background: #ffffff;
            border-radius: 12px;
            margin-top: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 123, 255, 0.1);
            position: relative;
            overflow: visible;
        }

        form.container {
            margin-bottom: 50px;
        }

        .container::before {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            right: -1px;
            bottom: -1px;
            background: linear-gradient(45deg, transparent, rgba(0, 123, 255, 0.1), transparent);
            border-radius: 12px;
            z-index: -1;
        }

        .input-group {
            margin-bottom: 25px;
            background: #ffffff;
            border-radius: 8px;
            overflow: hidden;
            width: 100%;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border: 1px solid #dee2e6;
        }

        .input-group:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.1);
        }

        .input-group-text {
            background: #f8f9fa;
            color: #495057;
            border: none;
            min-width: 120px;
            font-weight: 500;
            display: flex;
            align-items: center;
            height: 45px;
            text-transform: uppercase;
            font-size: 0.9em;
            letter-spacing: 0.5px;
            line-height: 32px;
            padding: 4px 13px;
            border-right: 1px solid #dee2e6;
        }

        .form-control, .form-select {
            background: #ffffff;
            border: none;
            color: #495057;
            height: 45px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #007bff;
            border: none;
            padding: 12px 40px;
            font-weight: 600;
            font-size: 16px;
            margin-top: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.2);
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.3);
        }

        h2 {
            color: #212529;
            position: relative;
            display: inline-block;
            margin-bottom: 40px;
        }

        h2::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(to right, #007bff, transparent);
        }

        /* 애니메이션 효과 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .container {
            animation: fadeIn 0.8s ease-out;
        }

        /* 셀렉트 박스 스타일링 */
        .form-select {
            background-color: #222222;
            color: #ffffff;
            border: 1px solid #333333;
            height: 45px;
            width: 100%;
            padding: 0 12px;
            border-radius: 4px;
            margin-top: 0;
        }

        .form-select:focus {
            background-color: #333333;
            border-color: #007bff;
            box-shadow: none;
        }

        /* 섹션 제목 스타일링 */
        h4 {
            color: #cccccc;
            font-size: 18px;
            margin-bottom: 10px;
            font-weight: 500;
        }

        /* 에러 메시지 스타일링 */
        .fieldError {
            color: #e22b59;
            font-size: 14px;
            margin-top: 5px;
        }

        /* 파일 업로드 영역 스타일링 */
        .mb3 {
            margin-bottom: 20px;
        }

        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .input-group-text {
                min-width: 100px;
            }
        }

        /* input과 select를 감싸는 컨테이너 추가 */
        .form-group {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        /* select와 input 너비 통일 */
        .form-select, .input-group {
            width: 100%;
            max-width: 800px;
            margin: 0 auto 25px;
        }

        /* 파일 input 스타일링 */
        .input-group.mb3 {
            display: flex;
            align-items: stretch;
        }

        .input-group.mb3 .form-control {
            height: 100%;
            line-height: 35px;
            padding: 4px 13px;
        }
        /* 영상 등록 제목 중앙 정렬 */
        .h2 {
            text-align: center;
            width: 100%;
            margin-bottom: 40px;
            position: relative;
            padding-bottom: 20px;
        }

        .h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(to right, #007bff, transparent);
        }

        /* select 컨테이너 스타일 */
        .select-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 25px;
        }

        .select-group {
            flex: 1;
            max-width: calc(33.333% - 14px);
        }

        .select-group h4 {
            background: rgba(51, 51, 51, 0.9);
            color: #ffffff;
            padding: 10px 15px;
            margin: 0;
            border-radius: 8px 8px 0 0;
            font-size: 0.9em;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .select-group .form-select {
            width: 100%;
            border: none;
            border-radius: 0 0 8px 8px;
            background: rgba(34, 34, 34, 0.8);
            color: #ffffff;
            padding: 10px 15px;
            height: 45px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .select-group .form-select:focus {
            background: rgba(51, 51, 51, 0.9);
            box-shadow: 0 0 0 2px rgba(106, 13, 173, 0.3);
        }

        /* hover 효과 */
        .select-group:hover .form-select {
            background: rgba(51, 51, 51, 0.9);
        }

        /* 파일 input 내부 텍스트 정렬 */
        .input-group.mb3 .form-control {
            display: flex;
            align-items: center;
            margin-bottom:0;
        }

        .input-group.mb3 .form-control::file-selector-button {
            height: 100%;
            margin-right: 15px;
            border: none;
            background: #f8f9fa;
            color: #495057;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .input-group.mb3 .form-control::file-selector-button:hover {
            background: #007bff;
            color: #ffffff;
        }

        .form-control::placeholder {
            color: #6c757d;
        }

        .file-upload-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .file-upload-container .input-group {
            margin-bottom: 0;
        }

        .current-file {
            flex: 1;
            padding: 0 15px;
            display: flex;
            align-items: center;
            font-size: 0.9em;
            color: #495057;
            background: #f8f9fa;
            border-radius: 0 8px 8px 0;
        }

        .file-path {
            display: inline-block;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .input-group.mb3 .form-control {
            border-left: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* 제목 밑줄 스타일 */
        .h2 {
            text-align: center;
            width: 100%;
            margin-bottom: 40px;
            position: relative;
        }

        .h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(to right, #6a0dad, transparent);
        }

        /* 입력 필드 스타일 수정 */
        input::placeholder,
        textarea::placeholder {
            color: rgba(170, 170, 170, 0.7) !important;
        }

        .form-control {
            background-color: rgba(30, 30, 30, 0.9);
            border: 1px solid rgba(106, 13, 173, 0.3);
            color: #fff;
        }

        .form-control:focus {
            background-color: rgba(30, 30, 30, 0.9);
            border-color: rgba(106, 13, 173, 0.5);
            color: #fff;
            box-shadow: 0 0 0 0.2rem rgba(106, 13, 173, 0.25);
        }

        /* select 요소의 placeholder 색상도 동일하게 적용 */
        select.form-control option {
            background-color: rgba(30, 30, 30, 0.9);
            color: rgba(170, 170, 170, 0.7);
        }

        select.form-control option:checked {
            background-color: rgba(106, 13, 173, 0.3);
            color: #fff;
        }
    </style>
</th:block>
<div layout:fragment="content">
    <div class="container">
        <div class="loading-overlay">
            <div class="loading-content">
                <i class="fas fa-plane plane-icon"></i>
                <div class="loading-text">최저가 항공권을 조회 중입니다...</div>
            </div>
        </div>
        <form role="form" method="post" enctype="multipart/form-data" th:object="${itemFormDto}">
            <input type="hidden" th:field="*{id}">
            <p class="h2">여행상품 등록</p>
            <div class="form-group">
                <label th:for="itemName">상품명</label>
                <input type="text" th:field="*{itemName}" class="form-control" placeholder="상품명을 입력해주세요">
                <p th:if="${#fields.hasErrors('itemName')}" th:errors="*{itemName}" class="fieldError">Incorrect data</p>
            </div>
            <div class="form-group">
                <label th:for="travelType">여행 타입</label>
                <select th:field="*{travelType}" class="form-control" id="travelType">
                    <option th:each="type : ${T(com.soloProject.myTrip.constant.TravelType).values()}"
                            th:value="${type}"
                            th:text="${type.description}">
                    </option>
                </select>
            </div>

            <div class="form-group" id="domesticDiv" style="display: none;">
                <label th:for="domesticCategory">국내여행 지역</label>
                <select th:field="*{domesticCategory}" class="form-control" id="domesticSel">
                    <option value="" disabled selected>선택해주세요</option>
                    <option th:each="category : ${T(com.soloProject.myTrip.constant.DomesticCategory).values()}"
                            th:value="${category}"
                            th:text="${category.description}">
                    </option>
                </select>
            </div>

            <div class="form-group" id="overseasDiv" style="display: none;">
                <label th:for="overseasCategory">해외여행 지역</label>
                <select th:field="*{overseasCategory}" class="form-control" id="overseasSel">
                    <option value="" disabled selected>선택해주세요</option>
                    <optgroup th:each="region : ${T(com.soloProject.myTrip.constant.OverseasCategory).getUniqueRegions()}"
                              th:label="${region}">
                        <option th:each="category : ${T(com.soloProject.myTrip.constant.OverseasCategory).values()}"
                                th:if="${category.region == region}"
                                th:value="${category}"
                                th:text="${category.description}">
                        </option>
                    </optgroup>
                </select>
            </div>

            <div class="form-group" id="themeDiv" style="display: none;">
                <label th:for="themeCategory">테마여행 종류</label>
                <select th:field="*{themeCategory}" class="form-control" id="themeSel">
                    <option value="" disabled selected>선택해주세요</option>
                    <option th:each="category : ${T(com.soloProject.myTrip.constant.ThemeCategory).values()}"
                            th:value="${category}"
                            th:text="${category.description}">
                    </option>
                </select>
            </div>

            <div class="form-group" id="airportCode">
                <label th:for="origin">출발 공항</label>
                <select th:field="*{origin}" class="form-control">
                    <option value="" disabled selected>선택해주세요</option>
                    <option th:each="code : ${T(com.soloProject.myTrip.constant.AirportCode).values()}"
                            th:value="${code}"
                            th:text="${code.name}">
                    </option>
                </select>
            </div>

            <div class="form-group">
                <label th:for="destination">도착 공항</label>
                <select th:field="*{destination}" class="form-control">
                    <option value="" disabled selected>선택해주세요</option>
                    <option th:each="code : ${T(com.soloProject.myTrip.constant.AirportCode).values()}"
                            th:value="${code}"
                            th:text="${code.name}">
                    </option>
                </select>
            </div>

            <div class="form-group">
                <label>부가항목</label>
                <div class="border p-3 rounded">

                    <div class="mb-3">
                        <label>여행 기간</label>
                        <input id="night" type="number" th:field="*{night}" required>
                        <label for="night">박</label>
                        <input id="duration" type="number" th:field="*{duration}" required>
                        <label for="duration">일</label>
                    </div>

                    <!-- 인솔자 -->
                    <div class="mb-3">
                        <label>인솔자</label>
                        <div class="d-flex gap-3">
                            <div class="form-check">
                                <input id="yesLeader" type="radio" th:field="*{hasLeader}" value="true" class="form-check-input">
                                <label for="yesLeader" class="form-check-label">동행</label>
                            </div>
                            <div class="form-check">
                                <input id="noLeader" type="radio" th:field="*{hasLeader}" value="false" class="form-check-input">
                                <label for="noLeader" class="form-check-label">없음(자유여행)</label>
                            </div>
                        </div>
                    </div>

                    <!-- 가이드 경비 -->
                    <div class="mb-3">
                        <label>가이드 경비</label>
                        <div class="d-flex gap-3 align-items-center">
                            <div class="form-check">
                                <input id="yesFee" type="radio" th:field="*{hasGuideFee}" value="true" class="form-check-input" onchange="toggleGuideFee(this)">
                                <label for="yesFee" class="form-check-label">있음</label>
                            </div>
                            <div class="form-check">
                                <input id="noFee" type="radio" th:field="*{hasGuideFee}" value="false" class="form-check-input" onchange="toggleGuideFee(this)">
                                <label for="noFee" class="form-check-label">없음</label>
                            </div>
                            <div id="guideFeeInput" style="display: none;">
                                <input type="number" th:field="*{guideFee}" class="form-control" placeholder="가이드 경비">
                                <select th:field="*{guideFeeUnit}" class="form-control mt-2">
                                    <option th:each="unit : ${T(com.soloProject.myTrip.constant.CurrencyUnit).values()}"
                                            th:value="${unit}"
                                            th:text="${unit.description} + '(' +${unit.sign} +')'"></option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- 쇼핑 -->
                    <div class="mb-3">
                        <label>쇼핑</label>
                        <div class="d-flex gap-3 align-items-center">
                            <div class="form-check">
                                <input id="yesShopping" type="radio" th:field="*{hasShopping}" value="true" class="form-check-input" onchange="toggleShopping(this)">
                                <label for="yesShopping" class="form-check-label">있음</label>
                            </div>
                            <div class="form-check">
                                <input id="noShopping" type="radio" th:field="*{hasShopping}" value="false" class="form-check-input" onchange="toggleShopping(this)">
                                <label for="noShopping" class="form-check-label">없음</label>
                            </div>
                            <div id="shoppingCountInput" style="display: none;">
                                <input type="number" th:field="*{shoppingCount}" class="form-control" placeholder="쇼핑 횟수">
                            </div>
                        </div>
                    </div>

                    <!-- 여행자 보험 -->
                    <div class="mb-3">
                        <label>여행자 보험</label>
                        <div class="d-flex gap-3">
                            <div class="form-check">
                                <input id="yesInsurance" type="radio" th:field="*{hasInsurance}" value="true" class="form-check-input">
                                <label for="yesInsurance" class="form-check-label">있음</label>
                            </div>
                            <div class="form-check">
                                <input id="noInsurance" type="radio" th:field="*{hasInsurance}" value="false" class="form-check-input">
                                <label for="noInsurance" class="form-check-label">없음</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label th:for="price">가격(항공권 제외)</label>
                <input type="number" th:field="*{price}" class="form-control" placeholder="항공권을 제외한 가격을 입력해주세요">
                <p th:if="${#fields.hasErrors('price')}" th:errors="*{price}" class="fieldError">Incorrect data</p>
            </div>
            <div class="form-group">
                <label th:for="maxParticipants">최대 인원</label>
                <input type="number" th:field="*{maxParticipants}" class="form-control" placeholder="최대 인원을 입력해주세요">
                <p th:if="${#fields.hasErrors('maxParticipants')}" th:errors="*{maxParticipants}" class="fieldError">Incorrect data</p>
            </div>

            <div class="form-group">
                <label th:for="minParticipants">최소 출발 인원</label>
                <input type="number" th:field="*{minParticipants}" class="form-control" placeholder="최소 출발 인원을 입력해주세요">
                <p th:if="${#fields.hasErrors('minParticipants')}" th:errors="*{minParticipants}" class="fieldError">Incorrect data</p>
            </div>

            <div class="form-group detail-image-container">
                <label class="detail-image-label" th:for="itemDetailImage">상품 설명 이미지</label>
                <p class="detail-image-description">* 상품의 상세 정보를 보여주는 이미지를 등록해주세요.</p>
                
                <!-- 수정 모드일 때 -->
                <div th:if="${itemFormDto.id != null}">
                    <div class="mb-3">
                        <img th:if="${itemFormDto.itemDetailImageUrl != null}" 
                             th:src="${itemFormDto.itemDetailImageUrl}"
                             class="detail-image-preview">
                    </div>
                    <input type="file" 
                           class="form-control detail-image-input" 
                           name="itemDetailImageFile"
                           accept="image/*">
                    <input type="hidden" 
                           th:if="${itemFormDto.itemDetailImageUrl != null}"
                           name="originalDetailImageUrl" 
                           th:value="${itemFormDto.itemDetailImageUrl}">
                </div>
                
                <!-- 새로운 등록일 때 -->
                <div th:if="${itemFormDto.id == null}">
                    <input type="file" 
                           class="form-control detail-image-input" 
                           name="itemDetailImageFile"
                           accept="image/*"
                           required>
                </div>
                
                <p th:if="${#fields.hasErrors('itemDetailImageUrl')}" 
                   th:errors="*{itemDetailImageUrl}" 
                   class="detail-image-error">
                    Incorrect data
                </p>
            </div>

            <!-- 썸네일 이미지 수정 영역 -->
            <div th:if="${not #lists.isEmpty(itemFormDto.thumbnailImageUrls)}">
                <div class="form-group image-container" id="editImageContainer">
                    <div th:each="imageUrl, status : ${itemFormDto.thumbnailImageUrls}" class="image-item mb-3">
                        <div class="form-group">
                            <label th:text="${status.index + 1} + '번째 썸네일 이미지'"></label>
                            <div class="border p-2">
                                <img th:src="${imageUrl}" class="img-fluid mb-2" style="max-width: 300px;">
                                <input type="file" class="form-control image-input" name="thumbnailImageFile">
                                <input type="hidden" name="originalImageUrls" th:value="${imageUrl}">
                                <button type="button" class="btn btn-outline-danger mt-2" 
                                        th:onclick="deleteImage([[${status.index}]], this)">이미지 삭제</button>
                            </div>
                        </div>
                    </div>
                    <div class="form-group mt-3">
                        <button type="button" class="btn btn-outline-secondary" onclick="addImageField('edit')">이미지 추가</button>
                    </div>
                </div>
            </div>

            <!-- 썸네일 이미지 등록 영역 -->
            <div th:if="${#lists.isEmpty(itemFormDto.thumbnailImageUrls)}">
                <div class="form-group image-container" id="newImageContainer">
                    <div class="image-item mb-3">
                        <div class="form-group">
                            <label>썸네일 이미지 (최대 5개)</label>
                            <input type="file" class="form-control" name="thumbnailImageFile">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <button type="button" class="btn btn-outline-secondary" onclick="addImageField('new')">이미지 추가</button>
                </div>
            </div>

            <div style="text-align: center" class="mt-4">
                <button th:if="${#strings.isEmpty(itemFormDto.id)}" 
                        th:action="@{/admin/item/new}"
                        type="submit" 
                        class="btn btn-primary">등록</button>
                <button th:unless="${#strings.isEmpty(itemFormDto.id)}" 
                        th:action="@{'/admin/item/'+${itemFormDto.id}}"
                        type="submit" 
                        class="btn btn-primary">수정</button>
                <button type="button" class="btn btn-secondary" 
                        onclick=history.back()>취소</button>
            </div>
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
        </form>
    </div>
</div>

<th:block layout:fragment="script">
    <script th:inline="javascript">
        $(document).ready(function() {
            const errorMessage = [[${errorMessage}]];
            if(errorMessage != null){
                alert(errorMessage);
            }
        });
        document.addEventListener('DOMContentLoaded', function() {
            const travelTypeSelect = document.getElementById('travelType');
            const domesticDiv = document.getElementById('domesticDiv');
            const overseasDiv = document.getElementById('overseasDiv');
            const themeDiv = document.getElementById('themeDiv');
            
            const domesticSelect = document.querySelector('select[name="domesticCategory"]');
            const overseasSelect = document.querySelector('select[name="overseasCategory"]');
            const themeSelect = document.querySelector('select[name="themeCategory"]');
            
            // 초기 상태 설정
            updateCategoryDisplay(travelTypeSelect.value);
            
            travelTypeSelect.addEventListener('change', function() {
                updateCategoryDisplay(this.value);
            });
            
            function updateCategoryDisplay(selectedType) {
                // 모든 카테고리 숨기기
                domesticDiv.style.display = 'none';
                overseasDiv.style.display = 'none';
                themeDiv.style.display = 'none';
                
                // 모든 select의 disabled 속성을 true로 설정
                domesticSelect.disabled = true;
                overseasSelect.disabled = true;
                themeSelect.disabled = true;
                
                // 선택된 타입에 따라 해당 카테고리만 표시하고 활성화
                switch(selectedType) {
                    case 'DOMESTIC':
                        domesticDiv.style.display = 'block';
                        domesticSelect.disabled = false;
                        break;
                    case 'OVERSEAS':
                        overseasDiv.style.display = 'block';
                        overseasSelect.disabled = false;
                        break;
                    case 'THEME':
                        themeDiv.style.display = 'block';
                        themeSelect.disabled = false;
                        break;
                }
                
                // 숨겨진 select들의 값을 초기화
                if (domesticSelect.disabled) domesticSelect.value = '';
                if (overseasSelect.disabled) overseasSelect.value = '';
                if (themeSelect.disabled) themeSelect.value = '';
            }
        });

        function deleteImage(index, button) {
            if (!confirm('이미지를 삭제하시겠습니까?')) {
                return;
            }

            const imageItem = button.closest('.image-item');
            const itemId = [[${itemFormDto.id}]];
            
            ajaxRequest(
                `/admin/item/${itemId}/image/${index}`,
                'DELETE',
                {},
                function(result) {
                    imageItem.remove();
                    reorderImageLabels();
                }
            );
        }

        function reorderImageLabels() {
            const container = document.getElementById('imageContainer');
            const labels = container.getElementsByTagName('label');
            for (let i = 0; i < labels.length; i++) {
                labels[i].textContent = `${i + 1}번째 상품 이미지`;
            }
        }

        function addImageField(mode) {
            const container = mode === 'edit' ? 
                document.getElementById('editImageContainer') : 
                document.getElementById('newImageContainer');
            const imageItems = container.getElementsByClassName('image-item');
            
            if (imageItems.length >= 5) {
                alert('이미지는 최대 5개까지만 등록 가능합니다.');
                return;
            }

            const newItem = document.createElement('div');
            newItem.className = 'image-item mb-3';
            
            if (mode === 'edit') {
                newItem.innerHTML = `
                    <div class="form-group">
                        <label>${imageItems.length + 1}번째 상품 이미지</label>
                        <div class="border p-2">
                            <input type="file" class="form-control image-input" name="thumbnailImageFile">
                            <button type="button" class="btn btn-outline-danger mt-2" onclick="removeImageField(this)">삭제</button>
                        </div>
                    </div>
                `;
            } else {
                newItem.innerHTML = `
                    <div class="form-group">
                        <label>${imageItems.length + 1}번째 상품 이미지</label>
                        <input type="file" class="form-control" name="thumbnailImageFile">
                        <button type="button" class="btn btn-outline-danger mt-2" onclick="removeImageField(this)">삭제</button>
                    </div>
                `;
            }
            
            container.appendChild(newItem);
        }

        function removeImageField(button) {
            const imageItem = button.closest('.image-item');
            const container = imageItem.closest('.image-container');
            imageItem.remove();
            
            // 번호 재정렬
            const labels = container.getElementsByTagName('label');
            for (let i = 0; i < labels.length; i++) {
                labels[i].textContent = `${i + 1}번째 상품 이미지`;
            }
        }

        function toggleGuideFee(radio) {
            const feeInput = document.getElementById('guideFeeInput');
            feeInput.style.display = radio.value === 'true' ? 'block' : 'none';
            if (radio.value === 'false') {
                feeInput.querySelector('input[type="number"]').value = '';
                feeInput.querySelector('select').value = 'KRW';
            }
        }

        function toggleShopping(radio) {
            const countInput = document.getElementById('shoppingCountInput');
            countInput.style.display = radio.value === 'true' ? 'block' : 'none';
            if (radio.value === 'false') {
                countInput.querySelector('input[type="number"]').value = '';
            }
        }

        // 페이지 로드 시 초기 상태 설정
        document.addEventListener('DOMContentLoaded', function() {
            const hasGuideFee = document.querySelector('input[name="hasGuideFee"]:checked');
            const hasShopping = document.querySelector('input[name="hasShopping"]:checked');
            
            if (hasGuideFee) toggleGuideFee(hasGuideFee);
            if (hasShopping) toggleShopping(hasShopping);
        });

        // form submit 이벤트 핸들러 추가
        document.querySelector('form').addEventListener('submit', function(e) {
            // 폼 유효성 검사
            if (this.checkValidity()) {
                document.querySelector('.loading-overlay').style.display = 'block';
            }
        });

        // 페이지 로드 완료 시 로딩 인디케이터 숨기기
        window.addEventListener('load', function() {
            document.querySelector('.loading-overlay').style.display = 'none';
        });

        // 상세 이미지 미리보기
        document.querySelector('input[name="itemDetailImageFile"]').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                if (!file.type.startsWith('image/')) {
                    alert('이미지 파일만 업로드 가능합니다.');
                    this.value = '';
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    let preview = document.querySelector('.detail-image-preview');
                    if (!preview) {
                        preview = document.createElement('img');
                        preview.className = 'detail-image-preview';
                        const container = document.querySelector('.detail-image-container');
                        container.insertBefore(preview, container.querySelector('input[type="file"]'));
                    }
                    preview.src = e.target.result;
                }
                reader.readAsDataURL(file);
            }
        });

        // 폼 제출 전 유효성 검사에 상세 이미지 검사 추가
        document.querySelector('form').addEventListener('submit', function(e) {
            const detailImageInput = document.querySelector('input[name="itemDetailImageFile"]');
            const originalDetailImageUrl = document.querySelector('input[name="originalDetailImageUrl"]');
            
            // 새로운 등록이거나 수정 시 새 이미지를 선택했을 때만 검사
            if (!originalDetailImageUrl && !detailImageInput.files[0]) {
                e.preventDefault();
                alert('상품 상세 설명 이미지는 필수입니다.');
                detailImageInput.focus();
            }
        });
    </script>
</th:block>

</html> 